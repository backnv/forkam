// Tab 2 specific JavaScript
document.addEventListener('DOMContentLoaded', function() {
    const tab2Input = document.getElementById('tab2-input');
    const tab2Output = document.getElementById('tab2-output');

    if (tab2Input && tab2Output) {
        tab2Input.addEventListener('input', function() {
            const text = this.value;
            tab2Output.innerHTML = `You typed: ${text}`;
            tab2Output.style.fontSize = `${16 + Math.min(text.length, 20)}px`;
        });
    }
});

// Keyword matcher functionality
document.addEventListener('DOMContentLoaded', function() {
    const textInput = document.getElementById('textInput');
    const checkButton = document.getElementById('checkKeywords');
    const resultDiv = document.getElementById('result');

    const keywordsArray = [
        {
            title: "Некорректная работа БНСО",
            key: [
                'БНСО', 'ГЛОНАСС', 'ГЛОНАС', 'ГЛОНСС', 'ГЛНАСС', 'система ГЛАНАСС', 'работает с перебоем', 'перебой', 'ошибка', 'нет сигнала', 'сигнал', 'завис',
                'некорректная работа', 'сбой', 'нестабильная работа', 'проблемы с БНСО', 'неисправность', 'корректность', 'корректно',
                'неправильная работа', 'некорректные данные', 'потеря сигнала', 'нестабильный сигнал',
                'проблемы с сигналом', 'некорректные координаты', 'ошибка координат', 'неправильные координаты',
                'некорректные данные ГЛОНАСС', 'проблемы с ГЛОНАСС', 'неисправность ГЛОНАСС', 'нестабильная работа ГЛОНАСС',
                'некорректные данные системы ГЛОНАСС', 'проблемы с системой ГЛОНАСС', 'неисправность системы ГЛОНАСС',
                'нестабильная работа системы ГЛОНАСС', 'некорректные данные БНСО', 'проблемы с БНСО', 'неисправность БНСО',
                'нестабильная работа БНСО', 'некорректные данные бортового навигационного спутникового оборудования',
                'проблемы с бортовым навигационным спутниковым оборудованием', 'неисправность бортового навигационного спутникового оборудования',
                'нестабильная работа бортового навигационного спутникового оборудования', 'некорректные данные навигационного оборудования',
                'проблемы с навигационным оборудованием', 'неисправность навигационного оборудования', 'нестабильная работа навигационного оборудования'
            ]
        },
        {
            title: "Некорректная работа ДУТ",
            key: [
                'ДУТ', 'работает с перебоем', 'перебой', 'ошибка', 'некорректная работа', 'сбой',
                'нестабильная работа', 'проблемы с ДУТ', 'неисправность', 'неправильная работа',
                'некорректные данные', 'потеря сигнала', 'нестабильный сигнал', 'проблемы с сигналом',
                'некорректные координаты', 'ошибка координат', 'неправильные координаты', 'некорректные данные ДУТ',
                'проблемы с ДУТ', 'неисправность ДУТ', 'нестабильная работа ДУТ', 'некорректные данные диспетчерского устройства',
                'проблемы с диспетчерским устройством', 'неисправность диспетчерского устройства', 'нестабильная работа диспетчерского устройства',
                'некорректные данные устройства', 'проблемы с устройством', 'неисправность устройства', 'нестабильная работа устройства',
                'некорректные данные диспетчерского оборудования', 'проблемы с диспетчерским оборудованием', 'неисправность диспетчерского оборудования',
                'нестабильная работа диспетчерского оборудования', 'некорректные данные оборудования', 'проблемы с оборудованием',
                'неисправность оборудования', 'нестабильная работа оборудования'
            ]
        },
        {
            title: "Нет данных ДУТ",
            key: [
                'ДУТ', 'нет данных', 'отсутствуют данные', 'данные не поступают', 'потеря данных',
                'отсутствие данных', 'данные не приходят', 'данные не передаются', 'данные не отображаются',
                'данные не доступны', 'данные не видны', 'данные не получены', 'данные не загружаются',
                'данные не обновляются', 'данные не актуальны', 'данные не корректны', 'данные не полны',
                'данные не соответствуют', 'данные не совпадают', 'данные не подтверждены', 'данные не проверены',
                'данные не зарегистрированы', 'данные не зафиксированы', 'данные не записаны', 'данные не сохранены',
                'данные не переданы', 'данные не отправлены', 'данные не получены', 'данные не приняты',
                'данные не обработаны', 'данные не проанализированы', 'данные не интерпретированы', 'данные не расшифрованы',
                'данные не декодированы', 'данные не преобразованы', 'данные не конвертированы', 'данные не переведены',
                'данные не транслированы', 'данные не переданы на сервер', 'данные не получены с сервера', 'данные не синхронизированы',
                'данные не обновлены', 'данные не актуализированы', 'данные не обновлены в реальном времени', 'данные не обновлены в режиме реального времени',
                'данные не обновлены в онлайн режиме', 'данные не обновлены в режиме онлайн', 'данные не обновлены в режиме реального времени',
                'данные не обновлены в режиме реального времени', 'данные не обновлены в режиме реального времени', 'данные не обновлены в режиме реального времени'
            ]
        },
        {
            title: "Нет данных от блока",
            key: [
                'блок', 'нет данных', 'отсутствуют данные', 'данные не поступают', 'потеря данных',
                'отсутствие данных', 'данные не приходят', 'данные не передаются', 'данные не отображаются',
                'данные не доступны', 'данные не видны', 'данные не получены', 'данные не загружаются',
                'данные не обновляются', 'данные не актуальны', 'данные не корректны', 'данные не полны',
                'данные не соответствуют', 'данные не совпадают', 'данные не подтверждены', 'данные не проверены',
                'данные не зарегистрированы', 'данные не зафиксированы', 'данные не записаны', 'данные не сохранены',
                'данные не переданы', 'данные не отправлены', 'данные не получены', 'данные не приняты',
                'данные не обработаны', 'данные не проанализированы', 'данные не интерпретированы', 'данные не расшифрованы',
                'данные не декодированы', 'данные не преобразованы', 'данные не конвертированы', 'данные не переведены',
                'данные не транслированы', 'данные не переданы на сервер', 'данные не получены с сервера', 'данные не синхронизированы',
                'данные не обновлены', 'данные не актуализированы', 'данные не обновлены в реальном времени', 'данные не обновлены в режиме реального времени',
                'данные не обновлены в онлайн режиме', 'данные не обновлены в режиме онлайн', 'данные не обновлены в режиме реального времени',
                'данные не обновлены в режиме реального времени', 'данные не обновлены в режиме реального времени', 'данные не обновлены в режиме реального времени'
            ]
        },
        {
            title: "Некорректный трек ТС",
            key: [
                'трек', 'некорректный', 'ошибка трека', 'трек неверный', 'неправильный трек',
                'некорректный маршрут', 'ошибка маршрута', 'маршрут неверный', 'неправильный маршрут',
                'некорректный путь', 'ошибка пути', 'путь неверный', 'неправильный путь', 'некорректный трек ТС',
                'ошибка трека ТС', 'трек ТС неверный', 'неправильный трек ТС', 'некорректный маршрут ТС',
                'ошибка маршрута ТС', 'маршрут ТС неверный', 'неправильный маршрут ТС', 'некорректный путь ТС',
                'ошибка пути ТС', 'путь ТС неверный', 'неправильный путь ТС', 'некорректный трек транспортного средства',
                'ошибка трека транспортного средства', 'трек транспортного средства неверный', 'неправильный трек транспортного средства',
                'некорректный маршрут транспортного средства', 'ошибка маршрута транспортного средства', 'маршрут транспортного средства неверный',
                'неправильный маршрут транспортного средства', 'некорректный путь транспортного средства', 'ошибка пути транспортного средства',
                'путь транспортного средства неверный', 'неправильный путь транспортного средства', 'некорректный трек автомобиля',
                'ошибка трека автомобиля', 'трек автомобиля неверный', 'неправильный трек автомобиля', 'некорректный маршрут автомобиля',
                'ошибка маршрута автомобиля', 'маршрут автомобиля неверный', 'неправильный маршрут автомобиля', 'некорректный путь автомобиля',
                'ошибка пути автомобиля', 'путь автомобиля неверный', 'неправильный путь автомобиля'
            ]
        },
        {
            title: "Зависание ТС в 1 координате",
            key: [
                'зависание', 'координата', 'одна координата', 'не движется', 'стоит на месте',
                'неподвижность', 'остановка', 'не двигается', 'не перемещается', 'не передвигается',
                'не изменяет положение', 'не меняет координаты', 'остается на месте', 'не движется с места',
                'не сдвигается', 'не перемещается с места', 'не передвигается с места', 'не изменяет местоположение',
                'не меняет местоположение', 'остается в одной точке', 'не движется в одной точке', 'стоит в одной точке',
                'неподвижность в одной точке', 'остановка в одной точке', 'не двигается в одной точке', 'не перемещается в одной точке',
                'не передвигается в одной точке', 'не изменяет положение в одной точке', 'не меняет координаты в одной точке',
                'остается в одной точке', 'не движется с места в одной точке', 'не сдвигается в одной точке',
                'не перемещается с места в одной точке', 'не передвигается с места в одной точке', 'не изменяет местоположение в одной точке',
                'не меняет местоположение в одной точке', 'остается в одной точке', 'не движется в одной точке', 'стоит в одной точке',
                'неподвижность в одной точке', 'остановка в одной точке', 'не двигается в одной точке', 'не перемещается в одной точке',
                'не передвигается в одной точке', 'не изменяет положение в одной точке', 'не меняет координаты в одной точке',
                'остается в одной точке', 'не движется с места в одной точке', 'не сдвигается в одной точке',
                'не перемещается с места в одной точке', 'не передвигается с места в одной точке', 'не изменяет местоположение в одной точке',
                'не меняет местоположение в одной точке'
            ]
        },
        {
            title: "Не отображается в мониторинге",
            key: [
                'мониторинг', 'не отображается', 'отсутствует в мониторинге', 'данные не видны',
                'не видно в мониторинге', 'не показывается в мониторинге', 'не отображается в системе мониторинга',
                'отсутствует в системе мониторинга', 'данные не видны в системе мониторинга', 'не видно в системе мониторинга',
                'не показывается в системе мониторинга', 'не отображается в мониторинге ТС', 'отсутствует в мониторинге ТС',
                'данные не видны в мониторинге ТС', 'не видно в мониторинге ТС', 'не показывается в мониторинге ТС',
                'не отображается в системе мониторинга ТС', 'отсутствует в системе мониторинга ТС', 'данные не видны в системе мониторинга ТС',
                'не видно в системе мониторинга ТС', 'не показывается в системе мониторинга ТС', 'не отображается в мониторинге автомобиля',
                'отсутствует в мониторинге автомобиля', 'данные не видны в мониторинге автомобиля', 'не видно в мониторинге автомобиля',
                'не показывается в мониторинге автомобиля', 'не отображается в системе мониторинга автомобиля', 'отсутствует в системе мониторинга автомобиля',
                'данные не видны в системе мониторинга автомобиля', 'не видно в системе мониторинга автомобиля', 'не показывается в системе мониторинга автомобиля',
                'не отображается в мониторинге транспортного средства', 'отсутствует в мониторинге транспортного средства',
                'данные не видны в мониторинге транспортного средства', 'не видно в мониторинге транспортного средства',
                'не показывается в мониторинге транспортного средства', 'не отображается в системе мониторинга транспортного средства',
                'отсутствует в системе мониторинга транспортного средства', 'данные не видны в системе мониторинга транспортного средства',
                'не видно в системе мониторинга транспортного средства', 'не показывается в системе мониторинга транспортного средства'
            ]
        }
    ];
    

    const specialWords = ['БНСО', 'ДУТ', 'ГЛОНАСС'];

    function generateRegex(word) {
        return new RegExp(word.replace(/[-\/\\^$*+?.()|[\]{}]/g, '\\$&'), 'gi');
    }

    function checkKeywords() {
        const text = textInput.value;
        resultDiv.innerHTML = '';
        
        if (!text.trim()) return;

        keywordsArray.forEach(category => {
            let matches = [];
            let matchCount = 0;

            category.key.forEach(keyword => {
                const regex = generateRegex(keyword);
                let match;
                while ((match = regex.exec(text)) !== null) {
                    matches.push({
                        keyword: match[0],
                        index: match.index
                    });
                    matchCount++;
                }
            });

            if (matchCount > 0) {
                // Sort matches by index
                matches.sort((a, b) => a.index - b.index);

                // Create highlighted text
                let highlightedText = text;
                let offset = 0;

                matches.forEach(match => {
                    const isSpecial = specialWords.some(word => match.keyword.toUpperCase().includes(word));
                    const highlightClass = isSpecial ? 'highlight-blue' : 'highlight';
                    const before = highlightedText.slice(0, match.index + offset);
                    const after = highlightedText.slice(match.index + offset + match.keyword.length);
                    highlightedText = before + `<span class="${highlightClass}">${match.keyword}</span>` + after;
                    offset += highlightClass.length + 23; // Length of span tags
                });

                const resultItem = document.createElement('div');
                resultItem.className = 'result-item expanded';
                resultItem.innerHTML = `
                    <div class="count">${matchCount}</div>
                    <div class="content">
                        <div class="title">${category.title}</div>
                        <div class="text">${highlightedText}</div>
                    </div>
                `;
                resultDiv.appendChild(resultItem);
            }
        });
    }

    // Event listeners
    textInput.addEventListener('input', checkKeywords);
    checkButton.addEventListener('click', checkKeywords);
    textInput.addEventListener('keydown', event => {
        if (event.key === 'Enter') {
            checkKeywords();
        }
    });
});